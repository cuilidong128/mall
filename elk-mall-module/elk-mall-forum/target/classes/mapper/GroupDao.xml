<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mall.forum.dao.GroupDao">
    <resultMap type="com.mall.forum.modle.Group" id="BaseResultMap">
        <result property="id" column="group_id" jdbcType="BIGINT"/>
        <result property="parentId" column="parent_id" jdbcType="BIGINT"/>
        <result property="name" column="group_name" jdbcType="VARCHAR"/>
        <result property="description" column="group_description" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="selectAll" resultMap="BaseResultMap">
      SELECT
      group_id,
      group_name,
      parent_id,
      group_description
      FROM jforum_groups
      ORDER BY group_name
    </select>

    <select id="selectById" resultMap="BaseResultMap">
      SELECT
      group_id,
      group_name,
      parent_id,
      group_description
      FROM jforum_groups WHERE group_id = #{groupId}
    </select>


    <select id="canDelete" resultType="boolean">
        SELECT COUNT(1) AS total FROM jforum_user_groups WHERE group_id = #{groupId}
    </select>

    <update id="delete" >
        DELETE FROM jforum_groups WHERE group_id = #{groupId}
    </update>

    <update id="update" parameterType="com.mall.forum.modle.Group">
        UPDATE jforum_groups
        <set>
            <if test="parentId != null">`parent_id` = #{parentId}, </if>
            <if test="name != null">`group_name` = #{name}, </if>
            <if test="description != null">`group_description` = #{description} </if>
        </set>
        WHERE group_id = #{groupId}
    </update>



    <insert id="addNew" parameterType="com.mall.forum.modle.Group" useGeneratedKeys="true" keyProperty="id">
        insert into jforum_groups
        (
        `parent_id`,
        `group_name`,
        `group_description`
        )
        values
        (
        #{parentId},
        #{name},
        #{description}
        )
    </insert>

</mapper>